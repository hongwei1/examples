<!DOCTYPE html>
<html>

<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <title>Template</title>
</head>

<body data-lift-content-id="main">

  <div id="main" data-lift="surround?with=default2;at=content">
    <center>
      <b>Stateless JSON Sample</b>
    </center>
    <br>
    <textarea id="json_question" rows="8" cols="50"></textarea>
    <br>
    <select id="json_select">
      <option value="show">Show</option>
      <option value="textile">Show in Textile</option>
      <option value="count">Count Characters</option>
      <option value="error">Show an error</option>
    </select>
    <br>
    <button onclick="jQuery.ajax({ url : 'stateless_json_call', data : JSON.stringify({'command': document.getElementById('json_select').value, 'params':document.getElementById('json_question').value}), type : 'POST', dataType : 'script', contentType: 'text/json', timeout : 5000, cache : false});">Click Me</button>
    <div id="json_result"></div>

    <p>Here's the code:</p>

    <pre><code class="scala">
object StatelessJson {
  def init() {
    // register the JSON handler
    LiftRules.statelessDispatch.append {
      case r @ Req("stateless_json_call" :: Nil, _, PostRequest) =>
        () =>
          handleJson(r)
    }
  }

  implicit def iterableToBox[X](in: Iterable[X]): Box[X] =
    in.toList.headOption

  def handleJson(req: Req): Box[LiftResponse] =
    for {
      json <- req.json // get the JSON
      JObject(
        List(JField("command", JString(cmd)),
             JField("params", JString(params)))) <- json // extract the command
    } yield
      JavaScriptResponse(
        SetHtml(
          "json_result",
          cmd match { // build the response
            case "show"    => Text(params)
            case "textile" => TextileParser.toHtml(params, Empty)
            case "count"   => Text(params.length + " Characters")
            case x         => &lt;b&gt;Problem... didn't handle JSON message {x}&lt;/b&gt;
          }
        ))
}
    </code></pre>
  </div>
</body>

</html>