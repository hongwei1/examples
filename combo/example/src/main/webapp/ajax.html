<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
    <title>Template</title>
</head>
<body data-lift-content-id="main">
<div id="main" data-lift="surround?with=default2;at=content">

    <!-- The AutoComplete function (widgets.autocomplete) used by Ajax.scala uses a
    really old jqurey so we need to add jquery migrate for that functionality to work. -->
    <head_merge>
        <script id="jquery-migrate" src="/classpath/fobo/jquery-migrate.js" type="text/javascript"></script>
    </head_merge>

    <center><b>AJAX Samples</b></center>
    <br >
    <div class="lift:Ajax.sample?id_name=cnt_id;id_msgs=messages">
        <div id="ajaxClicker">
            <span>Click me to increase the count (currently <span id='cnt_id'>0</span>)</span>
        </div>
        <!--    <ajax:clicker>
              <span>Click me to increase the count (currently <span id='cnt_id'>0</span>)</span>
            </ajax:clicker> -->
        <br>

        <div id="messages"></div>
        <div id="bcmessages"></div>

        <div id="ajaxSelect">
            You selected '<span id="selNumber"></span>' from the select box.
        </div>

        <!--    <ajax:select>
              You selected <sel:number></sel:number> From the select box.
            </ajax:select> -->

        <br>
        <div id="ajaxText">
            You entered '<span id="textValue"></span>' in the text box.
        </div>
        <!--    <ajax:text>
              You entered <text:value></text:value> in the text box.
            </ajax:text> -->

        <br>

        An example of autocomplete with a server round trip to
        calculate the autocomplete list
        <div id="ajaxAuto"></div>
        <!--    <ajax:auto></ajax:auto> -->
        <br>
        <br>

        <hr >
        <div>
            And each time an Ajax or Comet update is made to the page,
            we update this span:
            <span id="timely" class="lift:Timely">The time is</span>
        </div>


    </div>

    <p>
        Enter some text: <input id="the_input">
        and <button class="lift:Ajax.buttonClick">Click Here</button>
    </p>

    <br >

    The <i>Lift</i> Scala code to render the controls:
    <br >

    <pre><code class="scala">
class Ajax extends Loggable {

    def sample(xhtml: NodeSeq): NodeSeq = {
      // local state for the counter
      var cnt = 0

      // get the id of some elements to update
      val spanName: String = S.attr("id_name") openOr "cnt_id"
      val msgName: String = S.attr("id_msgs") openOr "messages"

      // build up an ajax &lt;a&gt; tag to increment the counter
      def doClicker(text: NodeSeq) =
        a(() => { cnt = cnt + 1; SetHtml(spanName, Text(cnt.toString)) },
          text)

      // create an ajax select box
      def doSelect(msg: NodeSeq) =
        ajaxSelect(
          (1 to 50).toList.map(i => (i.toString, i.toString)),
          Full(1.toString),
          v => {
            val selectBind = "#selNumber" #> Text(v)
            DisplayMessage(
              msgName,
              &lt;span&gt;{selectBind(msg)}&lt;/span&gt;,
              5 seconds,
              1 second
            )
          }
        )

      // build up an ajax text box
      def doText(msg: NodeSeq) =
        ajaxText(
          "",
          v => {
            val textBind = "#textValue" #> Text(v)
            DisplayMessage(msgName,
                           &lt;span&gt;{textBind(msg)}&lt;/span&gt;,
                           4 seconds,
                           1 second)
          }
        )

      // bind the view to the functionality
      val viewBind = {
        "#ajaxClicker" #> doClicker _ &
          "#ajaxSelect" #> doSelect _ &
          "#ajaxText" #> doText _ &
          "#ajaxAuto" #> AutoComplete("", buildQuery _, _ => ())
      }
      viewBind(xhtml)
    }

    private def buildQuery(current: String, limit: Int): Seq[String] = {
      logger.info(
        "Checking on server side with " + current + " limit " + limit)
      (1 to limit).map(n => current + "" + n)
    }

    def time = Text(now.toString)

    def buttonClick = {
      import js.JE._

      "* [onclick]" #> SHtml.ajaxCall(
        ValById("the_input"),
        s => SetHtml("bcmessages",
                     &lt;i&gt;Latest Button click was with text box value {s}&lt;/i&gt;))
    }
}</code></pre>


</div>
</body>
